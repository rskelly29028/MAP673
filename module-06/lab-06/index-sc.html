<html>
<head>
    <meta charset="utf-8">
    <title>Map 673 Lab 06 South Carolina Election</title>

    <link href="http://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet" type="text/css">
    
    
    <style>
        body {
            padding: 0;
            margin: 0;
            background: black;
            font-family: Montserrat, sans-serif;
        }
        .county {
            stroke: #fff;
        }
        .hover {
            fill: yellow;
        }
        h1   {
            position: absolute;
            left: 20px;
            top: 10px;
            font-size: 2em;
            font-weight: 100;
            color: white;
        }
        h2 {
            position: absolute;
            left: 20px;
            top: 60px;
            font-size: 1.5em;
            font-weight: 100;
            color: white;
        }
        h3 {
            position: absolute;
            left: 20px;
            top: 110px;
            font-size: 1.25em;
            font-weight: 10;
            color: blue;
        }
        h4 {
            position: absolute;
            left: 20px;
            top: 140px;
            font-size: 1.25em;
            font-weight: 10;
            color: red;
        }
        #map {
            width: 900px;
            height: 600px;
            margin: 10px auto;
            border: 1px solid black;
        }
    </style>
</head>
<body>
    <h1>South Carolina - General Election 2016</h1>
    <h2></h2>
    <h3></h3>
    <h4></h4>
    <div id="map"></div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/queue-async/1.0.7/queue.min.js"></script>

<script>
    
    var width = 900, height = 600;
    
    var color = ["#ff0000","#ff6342","#ff9473","#c6eff7","#63c6de","#0000ff"]
    
    var svg = d3.select("#map")
                .append("svg")
                .attr("width", width)
                .attr("height", height);
    
    var projection = d3.geo.albers()
        .center([0, 33.7])  // centering the project with lat value
        .rotate([80.9,0])  // rotating the earth to lon value
        .scale(7000)
        .translate([width / 2, height / 2]);
   
    var geoPath = d3.geo.path()        //  create a new geo path generator
                  .projection(projection);        // assign the project we just created to it
    
    queue()
        .defer(d3.json, "https://rkelly0007.carto.com/api/v2/sql?format=GeoJSON&q=SELECT * FROM south_carolina")
        .await(makeMap);
    
    function makeMap(error, counties){
        
        console.log(counties);   
        
        svg.append("g")            // create and append a new SVG 'g' element to the svg
                .selectAll("path")     // selectAll the path features that haven't been created yet
                .data(counties.features)  // bind the GeoJSON features data to them
                .enter()                    
                .append("path")        // append the newly create path elements to the 'g' 
                .attr("d", geoPath)  // define the screen coordinates of the new path(s)
                .attr("class", "county") // give each a class name of 'county'
                .style ("fill", function(d) {
                    if ((d.properties.clinton/[d.properties.clinton+d.properties.trump])>0.6) {return "#0000ff"}
                    if ((d.properties.clinton/[d.properties.clinton+d.properties.trump])>0.55) {return "#63c6de"}
                    if ((d.properties.clinton/[d.properties.clinton+d.properties.trump])>0.50) {return "#c6eff7"}
                    if ((d.properties.clinton/[d.properties.clinton+d.properties.trump])>0.45) {return "#ff9473"}
                    if ((d.properties.clinton/[d.properties.clinton+d.properties.trump])>0.40) {return "#ff6342"}
                        else {return "#ff0000"}
                }) // create the color bars for the election data
                .on("mouseover", function(d){
                    d3.select("h2").text(d.properties.name + ' county');
                    d3.select("h3").text(d.properties.clinton + ' votes for Hillary Clinton');
                    d3.select("h4").text(d.properties.trump + ' votes for Donald Trump');
                    d3.select(this).attr('class', 'hover');
                }) // generate text on mouseover
                .on ("mouseout", function(d){
                    d3.select("h2").text('');
                    d3.select("h3").text('');
                    d3.select("h4").text('');
                    d3.select(this).attr('class', 'county');
                });  // return to default on mouseout
    
            }
    
</script>
    
    
</body>
</html>
