<!DOCTYPE html>
<html>
<head>
    <meta charset=utf-8 />
    <title>MAP 673 Final Project</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.1.2/papaparse.min.js"></script>
    <script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/simple-statistics/1.0.0/simple_statistics.min.js"></script>
	<link href='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.css' rel='stylesheet' />
    <link href='https://fonts.googleapis.com/css?family=Work+Sans:400,500,600' rel='stylesheet' type='text/css'>

    <style>
      body {
            margin:0;
            padding:0;
            background: whitesmoke;
            font-family: "Work Sans", sans-serif;
      }
      #side-panel {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 33%;
            background: navy;
            border-right: 2px solid navy;
            overflow-y: scroll;
      }
      h1 {
            padding: 8px 25px 8px 15px;
            margin: 0;
            background: red;
            color: white;
            font-weight: 500;
            font-size: 2.5em;
            text-align: center;
        }
      h2 {
            margin: 0;
            padding: 8px 25px 8px 15px;
            color: white;
            font-weight: 500;
            font-size: 1.2em;
            text-align: left;
        }
        #side-panel p {
            margin: 8px 0 4px; 
            padding: 0 25px 0 15px;
            color: white;
            text-align: left;
            font-size: 1em; 
        }
        #side-panel p:after {
            content: '';
            display: block;
            clear: both;
        }
        #side-panel img {
            float: center;
            margin: 0 0 15px 15px;
            border: 1px solid white;
        }
      #map {
            position: absolute;
            top:0;
            bottom:0;
            right: 0;
            width: 67%;
      }
     #legend {
            position: absolute;
            background: whitesmoke;
            right: 15px;
            padding: 8px 15px;
            bottom: 20px;
            width: 160px;
            color: black;
            border: 1px solid black;
            border-radius: 3px;
      }
    #legend h3 {
            text-align: center;
            font-weight: 500;
            margin: 10px 0 20px;
        }
    #side-panel {
            
        }
    #info {
          padding: 8px 15px;
          position: absolute;
          color: black
          max-width: 200px;
          font-size: 1em;
          background: whitesmoke;
          border: 2px solid #000000;
          border-radius: 3px;
      }
    #info p {
          margin: 3px 0 4px;
      }
    </style>
    
</head>
<body>
    <div id='map'></div>
    <div id='side-panel'>
    <h1>THE CHOICE</h1>
    <h2>The 2016 US Presidential Election</h2>
        <p>This map displays voting data by state for the 2016 general election, and displays both 2016 voting and selected 2010 census data by county.</p>
    <p><img src="donald-trump-hillary-clinton-impossible-choice.png" alt="legend"></p>
        <p><i>Kenya, like the majority of nations around the world, has more females in its general population than it does males. Several counties in Kenya contradict the general sex ratio found across the nation. There are more males than females in the rural frontier counties bordering both Sudan and Somalia. This can be attributed to the fact that these poor rural regions of Kenya tend to be dominated by both the energy industry as well as being overrepresented by military personnel protecting the porous frontiers of the nation from the political turmoil of Sudan and the threat of Islamic militants from Somalia.  The urban areas of Kenya, in particular the capital of Nairobi, contain significantly more males as men are more apt to migrate to urban areas to find work in construction and/or other urban service occupations, leaving women behind to tend to family and agricutlrual responsibilities in rural regions, most notably in the western Lake District adjacent to Lake Victoria and the Tanzanian border.</i></p>
        <h2><u>About This Map</u></h2>
        <p><i>This map was created Friday, November 11, 2016 by Ryan Kelly</i></p>
    <h2><u>About the Data</u></h2>
        <p><i>The data were furnished from the Kenyan Open Data Portal located at the following URL:  https://opendata.go.ke/</i></p>
    </div>
    
    <div id="legend">
    <h3>Votes Per State</h3>
    <svg class="legend" width="200" height="200"></svg>
    </div>
	
    <div id="info">
    <p>State: <span> </span></p>
    <p>Clinton: <span1> </span1></p>
    <p>Trump: <span2> </span2></p>
    </div>
    
    <script src='https://cdnjs.cloudflare.com/ajax/libs/simple-statistics/1.0.1/simple_statistics.min.js'></script>
	<script src="http://code.jquery.com/jquery-3.1.1.min.js"></script>
	<script src='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.1.2/papaparse.min.js"></script>
	<script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.2.0/leaflet-omnivore.min.js'></script>
    <script>
        
    L.mapbox.accessToken = 'pk.eyJ1Ijoicmdkb25vaHVlIiwiYSI6Im5Ua3F4UzgifQ.PClcVzU5OUj17kuxqsY_Dg';

    L.Projection.Albers;
        
        var map = L.mapbox.map('map', 'mapbox.streets', {
            center: [38, -97.5],
            zoom: 4,
            minZoom: 2,
            maxZoom: 12
            //maxBounds: L.latLngBounds([-6.22, 27.72],[5.76, 47.83])
        });
    
    
        
        var dataLayer;
        
        $.getJSON("us-states.json",function(states){
            
            console.log(states);
            
            dataLayer = L.geoJson(states, {
                
                style: function (feature) { // style each feature of GeoJson layer
				    return {
				        color: 'green', // set stroke color
				        weight: 2.5, // set stroke weight
				        fillOpacity: 0, // override defautl fill opacity
					   };
				    }
                
            }).addTo(map); // add the Leaflet GeoJson layer to the map
            
            
            Papa.parse("Election-States.csv", {
            
                download: true,
                header: true,
	            complete: function(data) {
                   
            processstateData(states, data);
                    
	        }
                
            });
            
            }); 
    
            $.getJSON("US-Counties.json",function(counties){
                
                console.log(counties);
                
                dataLayer = L.geoJson(counties, {
                
                    style: function (feature) { // style each feature of GeoJson layer
				        return {
				            color: 'black', // set stroke color
				            weight: 0.5, // set stroke weight
				            fillOpacity: 0, // override defautl fill opacity
					       };
				        }
        
            }).addTo(map); // add the Leaflet GeoJson layer to the map
            
            Papa.parse("Master.csv", {
            
                download: true,
                header: true,
	            complete: function(data) {
                   
            processcountyData(counties, data);
                    
	        }
                
            });
            
            });   
        
        // create a function to loop through the states data and grab the state FIPS code to ensure a match for each state
        function processstateData(d, states){
            
            console.log(states);
            
            for (var state in states.features) {

                var stateprops = states.features[state].properties.name;

                for(var d in data.data) {
                    var state_FIP = states.features[state].properties.name,
                        state_fp = data.data[d].name
                    if(state_fp  === state_FIP){
                        states.features[state].properties = data.data[d];
                        console.log (states.features[state]);
                        break;
                    }
                }
                
                }
            
            }
        
        // create a function to loop through the counties data and grab the county FIPS code to ensure a match for each county
        function processcountyData(d, counties){
            
            console.log(counties);
            
            for (var county in counties.features) {

                var countyprops = counties.features[county].properties.name;

                for(var d in data.data) {
                    var county_FIPS = counties.features[county].properties.name,
                        fips = data.data[d].name
                    if(fips  === county_FIPS){
                        counties.features[county].properties = data.data[d];
                        console.log (counties.features[county]);
                        break;
                    }
                }

                }   
            
            }
        
    </script>
</body>
</html>